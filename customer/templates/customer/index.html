{% load static %}
{% load customer_extras %}


<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta name="description" content="">
        <meta name="author" content="">
        <title>Customer</title>

        <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
        <!-- Bootstrap core CSS -->
        <link href="{% static 'bootstrap/css/bootstrap.css' %}" rel="stylesheet">
        <!-- Custom styles for this template -->
        <link href="{% static 'dashboard.css' %}" rel="stylesheet">

         <link rel="stylesheet" type="text/css" href="{% static 'bootstrap-tagsinput.css' %}">
      	<link rel="stylesheet" type="text/css" href="{% static 'tools/imageDisplay.css' %}">

        <script type="text/javascript">

           function viewLoad(){
             document.getElementById("loading").style.visibility = "visible";
           }

        </script>

         <link href="{% static 'customer/css/profile2.css' %}" rel="stylesheet">
        <link rel="stylesheet" href="{% static 'customer/css/font-awesome-4.7.0/css/font-awesome.min.css' %}">
    </head>
    <body style="background-color: rgb(3,2,1);">

        <nav class="navbar navbar-dark fixed-top flex-md-nowrap p-0 shadow" style="background-color: rgb(3,2,1);">
            <a class="navbar-brand col-sm-3 col-md-2 mr-0" href="#">
                <img src="{%static 'images/1.png' %}">
            </a>
           <ul class="navbar-nav px-3">
                <li class="nav-item text-nowrap">
                    <button class="btn my-2 my-sm-0 btn-primary font-weight-bolder" type="button" onclick="out()">Sign Out</button>
                </li>
                 <script type="text/javascript">
                function out(){
                     window.location.replace("{% url 'dashboard:welcome_view' %}");
                }
            </script>
            </ul>
        </nav>
        <div class="container-fluid">
            <div class="row">
                <nav class="col-md-2 d-none d-md-block bg-light sidebar">
                    <div class="sidebar-sticky" style="background-color: rgb(3,2,1);">
                        <ul class="nav flex-column">
                            <li class="nav-item">
                                <a class="nav-link  text-primary" href="{% url 'dashboard:index_view' %}">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-home text-primary">
                                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                                    </svg>
                                    Dashboard
                                    <span class="sr-only">(current)</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link text-primary" href="{% url 'dvdReports:index_view' %}">
                                    <img src="{% static 'images/dvdIcon.png' %}">
                                    DVD Report
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link text-primary active font-weight-bolder" href="{% url 'customer:index_view' %}">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-users text-primary">
                                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                        <circle cx="9" cy="7" r="4"></circle>
                                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                    </svg>
                                    Customers
                                </a>
                            </li>


                                 <li class="nav-item">
                                <a class="nav-link text-primary" href="{% url 'order:index_view' %}">
                                    <svg width="24" height="24" viewBox="0 0 24 24" class="bi bi-shop" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                      <path fill-rule="evenodd" d="M2.97 1.35A1 1 0 0 1 3.73 1h8.54a1 1 0 0 1 .76.35l2.609 3.044A1.5 1.5 0 0 1 16 5.37v.255a2.375 2.375 0 0 1-4.25 1.458A2.371 2.371 0 0 1 9.875 8 2.37 2.37 0 0 1 8 7.083 2.37 2.37 0 0 1 6.125 8a2.37 2.37 0 0 1-1.875-.917A2.375 2.375 0 0 1 0 5.625V5.37a1.5 1.5 0 0 1 .361-.976l2.61-3.045zm1.78 4.275a1.375 1.375 0 0 0 2.75 0 .5.5 0 0 1 1 0 1.375 1.375 0 0 0 2.75 0 .5.5 0 0 1 1 0 1.375 1.375 0 1 0 2.75 0V5.37a.5.5 0 0 0-.12-.325L12.27 2H3.73L1.12 5.045A.5.5 0 0 0 1 5.37v.255a1.375 1.375 0 0 0 2.75 0 .5.5 0 0 1 1 0zM1.5 8.5A.5.5 0 0 1 2 9v6h1v-5a1 1 0 0 1 1-1h3a1 1 0 0 1 1 1v5h6V9a.5.5 0 0 1 1 0v6h.5a.5.5 0 0 1 0 1H.5a.5.5 0 0 1 0-1H1V9a.5.5 0 0 1 .5-.5zM4 15h3v-5H4v5zm5-5a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1v-3zm3 0h-2v3h2v-3z"/>
                                    </svg>
                                     Orders
                                </a>
                            </li>



                            <!-- <li class="nav-item">
                                <a class="nav-link" href="#">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-bar-chart-2">
                                        <line x1="18" y1="20" x2="18" y2="10"></line>
                                        <line x1="12" y1="20" x2="12" y2="4"></line>
                                        <line x1="6" y1="20" x2="6" y2="14"></line>
                                    </svg>
                                    Reports
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-layers">
                                        <polygon points="12 2 2 7 12 12 22 7 12 2"></polygon>
                                        <polyline points="2 17 12 22 22 17"></polyline>
                                        <polyline points="2 12 12 17 22 12"></polyline>
                                    </svg>
                                    Integrations
                                </a>
                            </li>
                        </ul>
                        <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted"> <span>Saved reports</span> <a class="d-flex align-items-center text-muted" href="#">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-plus-circle">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="12" y1="8" x2="12" y2="16"></line>
                                    <line x1="8" y1="12" x2="16" y2="12"></line>
                                </svg>
                            </a> </h6>
                        <ul class="nav flex-column mb-2">
                            <li class="nav-item">
                                <a class="nav-link" href="#">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                        <polyline points="14 2 14 8 20 8"></polyline>
                                        <line x1="16" y1="13" x2="8" y2="13"></line>
                                        <line x1="16" y1="17" x2="8" y2="17"></line>
                                        <polyline points="10 9 9 9 8 9"></polyline>
                                    </svg>
                                    Current month
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                        <polyline points="14 2 14 8 20 8"></polyline>
                                        <line x1="16" y1="13" x2="8" y2="13"></line>
                                        <line x1="16" y1="17" x2="8" y2="17"></line>
                                        <polyline points="10 9 9 9 8 9"></polyline>
                                    </svg>
                                    Last quarter
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                        <polyline points="14 2 14 8 20 8"></polyline>
                                        <line x1="16" y1="13" x2="8" y2="13"></line>
                                        <line x1="16" y1="17" x2="8" y2="17"></line>
                                        <polyline points="10 9 9 9 8 9"></polyline>
                                    </svg>
                                    Social engagement
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                        <polyline points="14 2 14 8 20 8"></polyline>
                                        <line x1="16" y1="13" x2="8" y2="13"></line>
                                        <line x1="16" y1="17" x2="8" y2="17"></line>
                                        <polyline points="10 9 9 9 8 9"></polyline>
                                    </svg>
                                    Year-end sale
                                </a>
                            </li>
                        </ul>  -->
                    </div>
                </nav>
                <main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-4">
                    <div class="chartjs-size-monitor" style="position: absolute; left: 0px; top: 0px; right: 0px; bottom: 0px; overflow: hidden; pointer-events: none; visibility: hidden; z-index: -1;">
                        <div class="chartjs-size-monitor-expand" style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;pointer-events:none;visibility:hidden;z-index:-1;">
                            <div style="position:absolute;width:1000000px;height:1000000px;left:0;top:0"></div>
                        </div>
                        <div class="chartjs-size-monitor-shrink" style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;pointer-events:none;visibility:hidden;z-index:-1;">
                            <div style="position:absolute;width:200%;height:200%;left:0; top:0"></div>
                        </div>
                    </div>
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">

                        <h1 class="h2 text-white font-weight-bolder">Customer Summary</h1>
                        <div class="btn-toolbar mb-2 mb-md-0" id="export">
                        </div>
                    </div>
                    <div class="table-responsive">
                        <div class="form-row">
                            <div class="col-sm-3-4 mb-3 mt-2 text-light ">
                                <label for="min">From Date Registered</label>
                                <input type="text" class="form-control" id="min" autocomplete="off"/>
                            </div>
                            <div class="col-sm-3-4 mb-3 mt-2 text-light ">
                                <label for="max">To Date Registered</label>
                                <input type="text" class="form-control" id="max" autocomplete="off"/>
                            </div>
                            <br>
                        </div>
                        <table class="table text-light " id="dvdTable">
                            <thead>
                                <tr>
                                    <th>Date Registered</th>
                                    <th>Firstname</th>
                                    <th>Lastname</th>
                                    <th>Date of Birth</th>
                                    <th>Address</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                 {% for custom in customers %}

                                <tr>
                                <td>{{custom.date_registered|date:"SHORT_DATE_FORMAT"}}</td>
                                        <td>{{ custom.firstname }}</td>
                                        <td>{{ custom.lastname }}</td>
                                        <td>{{custom.birthdate|date:"SHORT_DATE_FORMAT"}}</td>
                                        <td>{{ custom.address }}</td>
                                        
                                        <td>

                                            <button id="update" class="btn btn-lg mr-1" data-toggle="modal" data-target="#newModal-{{custom.employee_id}}" id="toupdate">
                                                <svg width="1em" height="1em" viewbox="0 0 16 16" class="bi bi-three-dots text-light" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                                    <path fill-rule="evenodd" d="M3 9.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3z"/>
                                                </svg>
                                            </button>
                                            <div class="modal fade" id="newModal-{{custom.employee_id}}" tabindex="-1" role="dialog" aria-labelledby="exampleModalScrollableTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title text-dark" id="exampleModalScrollableTitle">{{custom.firstname}},{{custom.lastname}}'s Information</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
{% for customer in customers|in_filter:custom.employee_id %}
      <div class="modal-body text-dark">
         <form id="updateForm" method="post" enctype="multipart/form-data" autocomplete="off">
        {% csrf_token %}

        <div class="form-row">
              <div class="col">
                  
                            <div class="col-md-4 mb-3 mt-4 {{customer.employee_id}}">              
                            <div class="img-thumbnail img-circle">
                              <div style="position: relative; padding: 0; cursor: pointer;" >
                                <img id="profile-pic{{customer.employee_id}}" name="profile_pic[]"  class="img-circle profile-pic" src="{{customer.profile_pic}}" style="width: 130px; max-height: 130px;  border-color: white;" >
                                <span class="imgthumb" style="position: absolute; ">  <i id="upload-button-{{customer.employee_id}}" class="fa fa-camera upload-button"></i></span>
                                 <input id="file-upload-{{customer.employee_id}}" name="profile_pic[]" style="display: none;" class="file-upload" type="file" accept="image/*"/>
                              </div>
                            </div>

                            </div>
                    </div>

                    <script type="text/javascript">
                                            
                                             $(document).ready(function() {


                            var readURL = function(input) {
                                if (input.files && input.files[0]) {
                                    var reader = new FileReader();

                                    reader.onload = function (e) {
                                        $('#profile-pic{{customer.employee_id}}').attr('src', e.target.result);
                                    }

                                    reader.readAsDataURL(input.files[0]);
                                }
                            }


                            $("#file-upload-{{customer.employee_id}}").on('change', function(){
                                readURL(this);
                            });

                            $("#upload-button-{{customer.employee_id}}").on('click', function() {
                               $("#file-upload-{{customer.employee_id}}").click();
                            });
                    });





$("input[name='profile_pic[]']").change(function () {
      $.ajax({
           type: "POST",
           url: "index_view",
           // data: $(this).parent().serialize(), // changed
           // data: $('#cast').val(),
            data: $("input[name='profile_pic[]']").serialize(),
            contentType: false,
           success: function(data) {
               console.log(data); // show response from the php script.

           },
    });
    return false; // avoid to execute the actual form submission.
    });




                    </script>
        </div>
         <div class="form-row">

              <div class="col-md-5 mb-4 mt-2">
                      <label for="validationDefault01">Employee ID</label>
                        <input type="text" name="employee_id" value="{{customer.employee_id}}" class="form-control"readonly/>
                    </div>

                    <div class="col-md-5 mb-4 mt-2">
                        <label for="validationDefault01">Date Registered</label>
                        <input type="Date" name="date_registered" class="form-control"  id="DateField" value="{{customer.date_registered|date:'c'}}" readonly="">
                       	 <script type="text/javascript">
                            		var dd = document.getElementById('DateField').value
                                    // console.log(dd);
						</script>
                    </div>
                   	
                </div>

                <div class="form-row">
                   	 <div class="col-md-5 mb-4 mt-2">
                    <label for="firstname">Firstname</label>
                    <input type="text" name ="firstname" class="form-control" id="Title" placeholder="Firstname" maxlength="100" value="{{customer.firstname}}" required/>
                    </div>
                   	  <div class="col-md-5 mb-4 mt-2">
                   <label for="Middlename">Middlename</label>
                        <input type="text" name ="middlename" class="form-control" id="Middlename" placeholder="Middlename" maxlength="100" value="{{customer.middlename}}" />
                    </div>

                      <div class="col-md-5 mb-4 mt-2">
                    <label for="Lastname">Lastname</label>
                    <input type="text" name ="lastname" class="form-control" id="Lastname" placeholder="Lastname" maxlength="100" value="{{customer.lastname}}" />
                    </div>

                     <div class="col-md-5 mb-4 mt-2">
                         <label for="Lastname">Address</label>
                    <input type="text" name ="address" class="form-control" id="Address" placeholder="Street, Brgy, City, Prov, Zip, Country" maxlength="355" autocomplete="off" value="{{customer.address}}" />
                    </div>

                </div>

                   <div class="form-row">
                   	  <div class="col-md-5 mb-4 mt-2">
                         <label for="validationDefault01">Birth Date</label>
                        <input name="birthdate" type="Date" class="form-control" id="DateField" value="{{customer.birthdate|date:'c'}}"  required />
                      
                    </div>
                   	  <div class="col-md-5 mb-4 mt-2">
                                 <label for="forstatus-{{customer.employee_id}}">Status</label>
                          <div class="form-group">
                          <select name="status" class="custom-select" id="forstatus-{{customer.employee_id}}"  required>
                            <option value="1">Single</option>
                            <option value="2">Married</option>
                            <option value="3">Widow/er</option>
                            <option value="4">Divorced</option>
                          </select>
                          <div class="invalid-feedback">Example invalid custom select feedback</div>
                        </div>
                          
                        <script type="text/javascript">
                               $("#forstatus-{{customer.employee_id}}").val("{{customer.status}}");
                        </script>

                    </div>

                </div>


   				<div class="form-row">
                   	  <div class="col-md-5 mb-4 mt-2">
                   	  	      <label for="forgender-{{customer.employee_id}}">Gender</label>    
                          <select name="gender" class="custom-select" id="forgender-{{customer.employee_id}}" required>
                            <option value="1">Male</option>
                            <option value="2">Female</option>
                          </select>
                          <div class="invalid-feedback">Example invalid custom select feedback</div>
                        </div>
                        <script type="text/javascript">
                                      $("#forgender-{{customer.employee_id}}").val("{{customer.gender}}");
                            
                        </script>


                         <div class="col-md-5 mb-4 mt-2">
                         <label for="validationDefault01">Spouse's Name</label>
                        <input type="text" name="spouse_name" class="form-control "  id="spouse_name" placeholder="Spouse's Name" maxlength="500" value="{{customer.spouse_name}}" />
                      
                    </div>


                     <div class="col-md-5 mb-4 mt-2">
                         <label for="validationDefault01">Spouse's Occupation</label>
                        <input name="spouse_occupation" type="text" class="form-control"  id="spouse_occupation"
                        placeholder="Spouse's Occupation"  maxlength="500" value="{{customer.spouse_occupation}}" />
                      
                      
                    </div>


                      <div class="col-md-5 mb-4 mt-2">
                         <label for="children">No. of Children</label>
           <input name="children" type="number" class="form-control"  id="children"
                        minlength="0" maxlength="5000" value="{{customer.children}}"   required="" />
                      
                      
                    </div>




















                                
                </div>

           </div>



      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        <button type="submit" id = "btnUpdate" name = "btnUpdate"  class="btn btn-primary">Update</button>
      </div>
    </div>
  </div>
</div>

  </form>

                                     <!--    Modal Delete -->
                                        <button  class="btn btn-lg"  data-toggle="modal" data-target="#deleteModal-{{customer.employee_id}}">
                                            <svg width="1em" height="1em" viewbox="0 0 16 16" class="bi bi-trash text-danger" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                                                <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4L4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
                                            </svg>
                                        </button>

                                        <div class="modal fade" id="deleteModal-{{customer.employee_id}}" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title text-dark" id="exampleModalLongTitle">Delete</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <form id="deleteForm" method="post" enctype="multipart/form-data" >
        {% csrf_token %}
               <input type="text" name="deleteInfo" value ={{customer.employee_id}} hidden>
      <div class="modal-body">
        <h5 class="text-danger">Are you sure you want to delete this item?</h5>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        <button type="submit" id="btnDelete" name = "btnDelete" class="btn btn-primary">Delete</button>
      </div>
      </form>
    </div>
  </div>
</div>





                                            <button id="update" class="btn btn-lg mr-1" data-toggle="modal" data-target="#orderModal-{{custom.employee_id}}" id="toupdate">
                                               <img src="{% static 'images/dvdIcon.png' %}">
                                            </button>
                                            <div class="modal fade" id="orderModal-{{custom.employee_id}}" tabindex="-1" role="dialog" aria-labelledby="exampleModalScrollableTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title text-dark" id="exampleModalScrollableTitle">Available DVDs</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>


      <div class="modal-body text-dark">
              <form id="orderForm" method="post" enctype="multipart/form-data" autocomplete="off">
                    {% csrf_token %}
              <h5>Your Cart</h5>
<div class="col-md-3">
          
        <div id="cart"></div>
        <table class="table-bordered">
            <thead>
                <tr>
                    <th>Product</th>
                     <th>Price</th>
                     <th>Action</th>
                </tr>
            </thead>
            <tbody id="carte-{{customer.employee_id}}">
            
                <tr >
                    <td>
                       <strong>Total</strong>
                    </td>
                    <td>
                        <input class="font-weight-bold" type="text" name="total" id="total-{{customer.employee_id}}" readonly="" value="0.0" style=" border: none;background: transparent;color: #000; font-weight: bolder;">


                    </td>
                    <td>
                        
                    </td>
                </tr>
            </tbody>
        </table>

<!--         <h2>Total <input type="text" name="total" id="total" readonly="" value="0.0"></h2>
 --></div>



        
   
            <input type="text" name="customerInfo" value ={{customer.employee_id}} hidden>
             <div class="form-row">

            {% for dvd in dvds %}
                                       
            {% for image in images|in_category:dvd.sku %}
                               {% if forloop.first %}          
                
                      <div class="col-md-5 mb-4 mt-2 {{dvd.sku}}">
                                  <div class="card text-center" style="max-width: 172.66px;"> 
              <img  class="imageThumb" style="max-width: 172.66px; max-height: 1500px;" src="{{image.link}}"/>
                <div class="card-body"> 
                    <h3 class="card-title">{{dvd.title }}</h3> 
                    <h4 class="card-text">₱{{dvd.price}}</h4>
                    <p class="card-text"><input type="text"  id="stocks-{{dvd.sku}}-{{customer.employee_id}}" style=" border: none;background: transparent;color: #000; text-align: center;" class="justify-content-center" value ={{dvd.items}}> stocks left</p> 
                    <input type="button" id="addcarts-{{dvd.sku}}-{{customer.employee_id}}" class="btn btn-primary" value="Add to Cart"></input>
                        
                            <script type="text/javascript">
                                 $('#total-{{customer.employee_id}}').val("0.00");
                                  $("#addcarts-{{dvd.sku}}-{{customer.employee_id}}").unbind("click").click( function()
                                    {
                                        var stocks = parseInt($('#stocks-{{dvd.sku}}-{{customer.employee_id}}').val())-1;
                                        if(stocks<1){
                                            $("#addcarts-{{dvd.sku}}-{{customer.employee_id}}").attr("disabled", true);
                                            $("#addcarts-{{dvd.sku}}-{{customer.employee_id}}").prop('value', 'Out of Stock');
                                        }
                                        $('#stocks-{{dvd.sku}}-{{customer.employee_id}}').val(stocks);
                                        console.log(stocks);
                                       $('#carte-{{customer.employee_id}}').prepend('<tr class="pipp"><td id=forprice-{{dvd.sku}}> <input type="text" name="orderInfos[]" value={{dvd.sku}} hidden><img  class="imageThumb" style="width="150px" height="150px" src="{{image.link}}"/>'+'<p>{{dvd.title}}<p></td><td> ₱{{dvd.price}} <input type="text" id="priceInfo-{{dvd.sku}}" value ={{dvd.price}} hidden></td><td><button id="removeBtn-{{dvd.sku}}-{{customer.employee_id}}" type="button" class="btn btn-danger btn-sm removess">Remove</button></td><tr>');
                                       // $('#forprice-{{dvd.sku}}').after("<td>₱{{dvd.price}}</td>");

                                                    var init = parseInt($('#total-{{customer.employee_id}}').val()) + parseInt("{{dvd.price}}");
                                                $('#total-{{customer.employee_id}}').val(parseFloat(init).toFixed(2));
                                    });



                                    $(document).on('click', '#removeBtn-{{dvd.sku}}-{{customer.employee_id}}', function (e) {
                                                 var init = parseInt($('#total-{{customer.employee_id}}').val()) - parseInt($('#priceInfo-{{dvd.sku}}').val());
                                                 console.log($('#priceInfo-{{dvd.sku}}').val());
                                                 $('#total-{{customer.employee_id}}').val(parseFloat(init).toFixed(2));
                                                $(this).closest('.pipp').remove();
                                        });



                            </script>

                </div>    

                     
                </div>     
                    </div>


                                {% endif %} 
                
                          {% endfor %}   
                        
              {% endfor %}                  
                     </div>







           </div>


      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        <button type="submit" id = "btnOrder" name = "btnOrder"  class="btn btn-primary">Confirm Order</button>
      </div>
    </div>
  </div>
</div>

  </form>


                                    </td>
                                </tr>
    {% endfor %}
        {% endfor %}


                            </tbody>
                                }
                        </table>
                </main>
            </div>
        </div>
        <!-- Bootstrap core JavaScript
    ================================================== -->
        <!-- Placed at the end of the document so the pages load faster -->
        {% block javascript %}
        <script src="{% static 'assets/js/jquery.min.js' %}"></script>
        <script src="{% static 'assets/js/popper.js' %}"></script>

 

        <link rel="stylesheet" type="text/css" href="{% static 'jqueryui/jquery-ui.css' %}">
        <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
        <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
        <script src="{% static 'bootstrap/js/bootstrap.min.js' %}"></script>
        <link rel="stylesheet" type="text/css" href="{% static 'DataTables/datatables.min.css' %}"/>
        <script type="text/javascript" src="{% static 'DataTables/datatables.min.js' %}"></script>
        <script type="text/javascript" src="{% static 'tools/functions.js' %}"></script>
        <script type="text/javascript" src="{% static 'bootstrap-tagsinput.js' %}"></script>
        <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.6.2/js/dataTables.buttons.min.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
        <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.6.2/js/buttons.html5.min.js"></script>
        
       
                    






        <script>

   $.ajaxSetup({
        beforeSend: function(xhr, settings) {
            function getCookie(name) {
                var cookieValue = null;
                if (document.cookie && document.cookie != '') {
                    var cookies = document.cookie.split(';');
                    for (var i = 0; i < cookies.length; i++) {
                        var cookie = jQuery.trim(cookies[i]);
                        // Does this cookie string begin with the name we want?
                        if (cookie.substring(0, name.length + 1) == (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }
            if (!(/^http:.*/.test(settings.url) || /^https:.*/.test(settings.url))) {
                // Only send the token to relative URLs i.e. locally.
                xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
            }
        }
    });

  </script>













        <script type="text/javascript">
      $(document).ready(function () {

            $.fn.dataTable.ext.search.push(
                function (settings, data, dataIndex) {
                    var min = $('#min').datepicker("getDate");
                    var max = $('#max').datepicker("getDate");
										var startDate = new Date(data[0])
                    if (min == null && max == null) { return true; }
                    if (min == null && startDate <= max) { return true;}
                    if(max == null && startDate >= min) {return true;}
                    if (startDate <= max && startDate >= min) { return true; }
                    return false;
                }
            );


            $("#min").datepicker({ onSelect: function () { table.draw(); }, changeMonth: true, changeYear: true , dateFormat:"mm/dd/yy"});
            $("#max").datepicker({ onSelect: function () { table.draw(); }, changeMonth: true, changeYear: true, dateFormat:"mm/dd/yy" });
            var table = $('#dvdTable').DataTable({

    buttons: [
        {
            extend: 'excelHtml5',
            text: '<svg width="24" height="24" viewBox="0 0 16 16" class="bi bi-file-earmark-arrow-down" fill="currentColor" xmlns="http://www.w3.org/2000/svg">'+
'                                <path d="M4 0h5.5v1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V4.5h1V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2z"/>'+
'                                 <path d="M9.5 3V0L14 4.5h-3A1.5 1.5 0 0 1 9.5 3z"/>'+
'                                 <path fill-rule="evenodd" d="M8 6a.5.5 0 0 1 .5.5v3.793l1.146-1.147a.5.5 0 0 1 .708.708l-2 2a.5.5 0 0 1-.708 0l-2-2a.5.5 0 1 1 .708-.708L7.5 10.293V6.5A.5.5 0 0 1 8 6z"/>'+
'                                </svg>'+'Export',

            className:'btn btn-sm btn-outline-secondary export-excel',
            exportOptions: {
             columns: [ 0, 1, 2, 3, 4, 5 ]
            }
        }
    ]
} );
   table.buttons(0,null).container().appendTo("#export");


            // Event listener to the two range filtering inputs to redraw on input
            $('#min, #max').change(function () {
                table.draw();
            });
        });





// $(".removes").click(function(e){
//               $(e.target).remove();
//                 console.log("remove nana");
//             $(this).parent(".pip").remove();


// });






$("input[name='orderInfos[]']").change(function () {
      $.ajax({
           type: "POST",
           url: "index",
           // data: $(this).parent().serialize(), // changed
           // data: $('#cast').val(),
            data: $("input[name='orderInfos[]']").serialize(),
            contentType: false,
           success: function(data) {
               console.log(data); // show response from the php script.

           },
    });
    return false; // avoid to execute the actual form submission.
    });









</script>


        {% endblock %}

        <!-- Icons -->
        <script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script>
        <script>feather.replace()</script>
    </body>
</html>